server {

	listen 443 ssl http2;
	listen [::]:443 ssl http2;

	server_name download.versatiles.org;

	ssl_certificate /etc/letsencrypt/live/download.versatiles.org/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/download.versatiles.org/privkey.pem;
	ssl_trusted_certificate /etc/letsencrypt/live/download.versatiles.org/fullchain.pem;

	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_prefer_server_ciphers on;
	ssl_dhparam /etc/nginx/dhparam.pem;
	ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384;
	ssl_ecdh_curve secp384r1;
	ssl_session_timeout  10m;
	ssl_session_cache shared:SSL:10m;
	ssl_session_tickets off;
	ssl_stapling on;
	ssl_stapling_verify on;
	resolver 9.9.9.9 80.80.80.80 [2a11::];
	resolver_timeout 5s;
	add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";
	add_header X-Content-Type-Options nosniff;
	add_header X-XSS-Protection "1; mode=block";

	access_log off;
	log_not_found off;
	error_log /var/www/download.versatiles.org/logs/error.log emerg;

	etag on;
	gzip_static on;
	brotli_static on;

	root /var/www/download.versatiles.org/docs;
	index index.html;
	charset utf-8;

	# certbot passthrough
	location /.well-known {
		root /var/www;
	}

	# deny access to hidden
	location ~ /\/\.(git|ht|DS_|npm)/ {
		deny all;
	}

	location = /robots.txt {
		add_header Content-Type text/plain;
		return 200 "User-agent: *\nDisallow:\n";
	}

	location = /favicon.ico {
		root /home/web/download.versatiles.org/docs/favicon.ico;
	}

	location = / {
		root /home/web/download.versatiles.org/docs/index.html;
	}
	
	location = /urllist.tsv {
		root /home/web/download.versatiles.org/docs/urllist.tsv;
	}
}
